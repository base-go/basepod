import{_ as W}from"./tJWclS3g.js";import{_ as q}from"./0Yzb4Lnv.js";import{e as I,p as Q,r as l,i as Z,c as F,o as i,a as s,b as o,w as a,f as m,k as u,t as P,j as t,m as z,d as c,q as G}from"./CZ2E-hhs.js";import{_ as H,$ as E,u as J}from"./MvbDxeM_.js";import{a as K,_ as X}from"./Cbo2LUgi.js";import{_ as Y}from"./B90aEjH0.js";import"./Zbpqj24h.js";import"./C9uKz0Pb.js";import"./D6CHZKLN.js";const ee={class:"max-w-3xl space-y-6"},se={class:"flex items-center justify-between"},te={class:"space-y-4"},ae={class:"flex items-center justify-between py-2"},oe={class:"text-2xl font-mono"},le={class:"text-right"},re={class:"text-xl font-mono"},ne={class:"flex gap-2"},de={class:"space-y-4"},ie={class:"space-y-4"},ue={class:"flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-800"},me={class:"text-right"},ce={key:0,class:"text-xs text-red-500 mt-1"},pe={class:"flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-800"},fe={class:"flex items-center justify-between py-2"},ve={class:"space-y-4"},we={class:"text-xs mt-2 whitespace-pre-wrap"},ye={class:"flex items-center justify-between"},Se=I({__name:"settings",async setup(_e){let k,B;const{data:V}=([k,B]=Q(()=>J("/health")),k=await k,B(),k),f=l(null),$=l(!1),A=l(!1),h=l(""),v=l(""),N=async()=>{$.value=!0,v.value="";try{f.value=await E("/system/version")}catch(n){const e=n;v.value=e.data?.error||"Failed to check version"}finally{$.value=!1}},T=async()=>{A.value=!0,h.value="",v.value="";try{const n=await E("/system/update",{method:"POST"});h.value=n.message,await N()}catch(n){const e=n;v.value=e.data?.error||"Update failed"}finally{A.value=!1}};Z(()=>{N()});const w=l({domain:"",email:"",enableWildcard:!0}),r=l({currentPassword:"",newPassword:"",confirmPassword:""}),y=l(""),j=l(!1),D=l(!1),L=async()=>{if(y.value="",j.value=!1,r.value.newPassword!==r.value.confirmPassword){y.value="Passwords do not match";return}if(r.value.newPassword.length<8){y.value="Password must be at least 8 characters";return}D.value=!0;try{await E("/auth/change-password",{method:"POST",body:{currentPassword:r.value.currentPassword,newPassword:r.value.newPassword}}),j.value=!0,r.value={currentPassword:"",newPassword:"",confirmPassword:""}}catch(n){const e=n;y.value=e.data?.error||"Failed to change password"}finally{D.value=!1}},R=l(!1),C=l(""),U=l(""),M=async()=>{if(confirm("This will remove all unused containers, images, and volumes. Continue?")){R.value=!0,C.value="",U.value="";try{const n=await E("/system/prune",{method:"POST"});C.value=n.output||"Prune completed successfully"}catch(n){const e=n;U.value=e.data?.error||"Prune failed"}finally{R.value=!1}}};return(n,e)=>{const S=W,p=q,g=z,b=H,x=X,_=K,O=Y;return i(),F("div",null,[s("div",ee,[o(b,null,{header:a(()=>[s("div",se,[e[7]||(e[7]=s("h3",{class:"font-semibold"},"System Update",-1)),t(f)?.updateAvailable?(i(),m(S,{key:0,color:"warning"},{default:a(()=>[...e[6]||(e[6]=[c("Update Available",-1)])]),_:1})):u("",!0)])]),default:a(()=>[s("div",te,[s("div",ae,[s("div",null,[e[8]||(e[8]=s("p",{class:"font-medium"},"Current Version",-1)),s("p",oe,"v"+P(t(f)?.current||"..."),1)]),s("div",le,[e[9]||(e[9]=s("p",{class:"text-sm text-gray-500"},"Latest Version",-1)),s("p",re,"v"+P(t(f)?.latest||"..."),1)])]),t(f)?.updateAvailable?(i(),m(p,{key:0,color:"info",variant:"soft",title:"A new version is available",description:"Click 'Update Now' to download and install the latest version."})):u("",!0),t(h)?(i(),m(p,{key:1,color:"success",variant:"soft",title:t(h)},null,8,["title"])):u("",!0),t(v)?(i(),m(p,{key:2,color:"error",variant:"soft",title:t(v)},null,8,["title"])):u("",!0),s("div",ne,[o(g,{variant:"soft",loading:t($),onClick:N},{default:a(()=>[...e[10]||(e[10]=[c(" Check for Updates ",-1)])]),_:1},8,["loading"]),t(f)?.updateAvailable?(i(),m(g,{key:0,color:"primary",loading:t(A),onClick:T},{default:a(()=>[...e[11]||(e[11]=[c(" Update Now ",-1)])]),_:1},8,["loading"])):u("",!0)])])]),_:1}),o(b,null,{header:a(()=>[...e[12]||(e[12]=[s("h3",{class:"font-semibold"},"Domain Settings",-1)])]),default:a(()=>[s("div",de,[o(_,{label:"Root Domain",help:"The main domain for your deployer instance"},{default:a(()=>[o(x,{modelValue:t(w).domain,"onUpdate:modelValue":e[0]||(e[0]=d=>t(w).domain=d),placeholder:"deployer.example.com"},null,8,["modelValue"])]),_:1}),o(_,{label:"Email",help:"Used for Let's Encrypt SSL certificates"},{default:a(()=>[o(x,{modelValue:t(w).email,"onUpdate:modelValue":e[1]||(e[1]=d=>t(w).email=d),type:"email",placeholder:"admin@example.com"},null,8,["modelValue"])]),_:1}),o(_,null,{default:a(()=>[o(O,{modelValue:t(w).enableWildcard,"onUpdate:modelValue":e[2]||(e[2]=d=>t(w).enableWildcard=d),label:"Enable wildcard subdomains"},null,8,["modelValue"])]),_:1}),o(g,null,{default:a(()=>[...e[13]||(e[13]=[c("Save Domain Settings",-1)])]),_:1})])]),_:1}),o(b,null,{header:a(()=>[...e[14]||(e[14]=[s("h3",{class:"font-semibold"},"Change Password",-1)])]),default:a(()=>[s("form",{class:"space-y-4",onSubmit:G(L,["prevent"])},[o(_,{label:"Current Password"},{default:a(()=>[o(x,{modelValue:t(r).currentPassword,"onUpdate:modelValue":e[3]||(e[3]=d=>t(r).currentPassword=d),type:"password",placeholder:"Enter current password"},null,8,["modelValue"])]),_:1}),o(_,{label:"New Password"},{default:a(()=>[o(x,{modelValue:t(r).newPassword,"onUpdate:modelValue":e[4]||(e[4]=d=>t(r).newPassword=d),type:"password",placeholder:"Enter new password"},null,8,["modelValue"])]),_:1}),o(_,{label:"Confirm New Password"},{default:a(()=>[o(x,{modelValue:t(r).confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=d=>t(r).confirmPassword=d),type:"password",placeholder:"Confirm new password"},null,8,["modelValue"])]),_:1}),t(y)?(i(),m(p,{key:0,color:"error",variant:"soft",title:t(y)},null,8,["title"])):u("",!0),t(j)?(i(),m(p,{key:1,color:"success",variant:"soft",title:"Password changed successfully"})):u("",!0),o(g,{type:"submit",loading:t(D)},{default:a(()=>[...e[15]||(e[15]=[c(" Change Password ",-1)])]),_:1},8,["loading"])],32)]),_:1}),o(b,null,{header:a(()=>[...e[16]||(e[16]=[s("h3",{class:"font-semibold"},"System Status",-1)])]),default:a(()=>[s("div",ie,[s("div",ue,[e[17]||(e[17]=s("div",null,[s("p",{class:"font-medium"},"Podman"),s("p",{class:"text-sm text-gray-500"},"Container runtime")],-1)),s("div",me,[o(S,{color:t(V)?.podman==="connected"?"success":"error"},{default:a(()=>[c(P(t(V)?.podman==="connected"?"Connected":"Disconnected"),1)]),_:1},8,["color"]),t(V)?.podman!=="connected"?(i(),F("p",ce,P(t(V)?.podman_error),1)):u("",!0)])]),s("div",pe,[e[19]||(e[19]=s("div",null,[s("p",{class:"font-medium"},"Caddy"),s("p",{class:"text-sm text-gray-500"},"Reverse proxy")],-1)),o(S,{color:"success"},{default:a(()=>[...e[18]||(e[18]=[c("Running",-1)])]),_:1})]),s("div",fe,[e[21]||(e[21]=s("div",null,[s("p",{class:"font-medium"},"Database"),s("p",{class:"text-sm text-gray-500"},"SQLite")],-1)),o(S,{color:"success"},{default:a(()=>[...e[20]||(e[20]=[c("Connected",-1)])]),_:1})])])]),_:1}),o(b,{class:"border-red-200 dark:border-red-900"},{header:a(()=>[...e[22]||(e[22]=[s("h3",{class:"font-semibold text-red-600"},"Danger Zone",-1)])]),default:a(()=>[s("div",ve,[t(C)?(i(),m(p,{key:0,color:"success",variant:"soft",title:"Prune completed"},{default:a(()=>[s("pre",we,P(t(C)),1)]),_:1})):u("",!0),t(U)?(i(),m(p,{key:1,color:"error",variant:"soft",title:t(U)},null,8,["title"])):u("",!0),s("div",ye,[e[24]||(e[24]=s("div",null,[s("p",{class:"font-medium"},"Prune Unused Resources"),s("p",{class:"text-sm text-gray-500"},"Remove unused containers, images, and volumes")],-1)),o(g,{color:"error",variant:"soft",loading:t(R),onClick:M},{default:a(()=>[...e[23]||(e[23]=[c(" Prune ",-1)])]),_:1},8,["loading"])])])]),_:1})])])}}});export{Se as default};
